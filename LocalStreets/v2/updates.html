<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>Road Inventory Updates</title>

        <link rel="stylesheet" href="http://js.arcgis.com/3.14/dijit/themes/tundra/tundra.css"><!-- swamp thang -->
        <link rel="stylesheet" href="http://js.arcgis.com/3.14/esri/css/esri.css">
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="http://cdn.jsdelivr.net/jquery.slick/1.5.7/slick.css"/>
        <link rel="stylesheet" type="text/css" href="http://cdn.jsdelivr.net/jquery.slick/1.5.7/slick-theme.css"/>

        <style type="text/css">
            html, body, #divMap {
                padding: 0;
                margin: 0;
                height: 100%;
            }
            #info {
                position: absolute;
                bottom: 1px;
                left: 20px;
                z-index: 50;
                color: #303030;
                text-shadow: -1px 0 white, 0 1px white, 1px 0 white, 0 -1px white;
            }
            #basemapTrigger {
                position: absolute;
                bottom: 0;
                width: 100%;
                height: 1px;
                z-index: 51;
            }
            #basemapPanel {
                position:absolute;
                bottom:0;
                /*display:none;*/
                padding-left:30px;
                padding-right: 30px;
                margin:0;
                background: rgb(0, 0, 0);
                background: rgba(0, 0, 0, 0.5);
                width: 100%;
                height: 180px;
                z-index: 50;
                overflow: hidden;
                vertical-align: center;
            }
            #basemapItemList {
                margin:auto;
                width:100%;
                height:100%;
            }
            .basemapItem {
                height: 100%;
                margin:10px;
                text-align: center;
                cursor: pointer;
            }
            .basemapImg {
                width:100%;
                max-height:133px;
            }

            select {
                cursor: pointer;
            }
            

            /* Menu */
            #menuBtn {
                position: absolute;
                top: 90px;
                left: 20px;
                width: 33px;
                z-index: 50;
                padding-left: 3px;
                padding-right: 3px;
                padding-top: 6px;
                padding-bottom: 4px;
                margin: 0;
                /*border-color: black;*/
            }
            #menuContainer {
                position: absolute;
                top: 120px;
                left: 15px;
                z-index: 50;
                padding: 0;
                margin: 0;
                width: 200px;
            }
            #menuPanel {
                position:absolute;
                display:none;
                padding:5px;
                margin:5px;
                background: rgb(0, 0, 0);
                background: rgba(0, 0, 0, 0.5);
                border: 1px solid #ccc;
                border-radius: 5px;
            }
            #accordion {
                margin-bottom: 0;
            }
            #downloadFormat, #chooseData {
                padding: 0;
            }
            .panel-default > .panel-heading {
                cursor: pointer;
                background-color: #75A262;
                color:#FFFFFF;
                border-radius: 4px 4px 0px 0px;
            }
            .panel-heading.collapsed {
                background-color: #C2C4C5;
                border-color: #C2C4C5;
            }
            .btn-file {
                position: relative;
                overflow: hidden;
            }
            .btn-file input[type=file] {
                position: absolute;
                top: 0;
                right: 0;
                min-width: 100%;
                min-height: 100%;
                font-size: 100px;
                text-align: right;
                opacity: 0;
                outline: none;
                background: white;
                cursor: inherit;
                display: block;
            }
            span.dijit.dijitReset.dijitInline.dijitButton.atiButton.atiDeleteButton {
                margin: .2em;
                width: 50px;
            }
        
        </style>

        <script data-dojo-config="async:true, aliases: [
            ['jquery', 'http://code.jquery.com/jquery-2.1.4.min.js'],
            ['jqueryui', 'http://code.jquery.com/ui/1.11.4/jquery-ui.min.js'],
            ['slick', 'http://cdn.jsdelivr.net/jquery.slick/1.5.7/slick.min.js'],
            ['bootstrap', 'http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js']
            ]" src="http://js.arcgis.com/3.14/">
        </script><!-- swamp thang -->

        <script>
            require([
                "jquery",
                "jqueryui",
                "slick",

                "esri/map",
                "esri/graphic",
                "esri/geometry/Geometry",
                "esri/toolbars/edit",
                "esri/toolbars/draw",
                "esri/geometry/Extent",
                "esri/geometry/Point",
                "esri/basemaps",

                "esri/request",
                "esri/geometry/scaleUtils",
                "esri/geometry/webMercatorUtils",
                "esri/geometry/geodesicUtils",
                "esri/config",
                "esri/tasks/query",
                "esri/tasks/QueryTask",

                "esri/tasks/Geoprocessor",
                "esri/layers/FeatureLayer",
                "esri/dijit/Basemap",
                "esri/dijit/BasemapGallery",
                "esri/tasks/GeometryService",
                "esri/units",

                "esri/dijit/Legend",
                "esri/dijit/editing/TemplatePicker",
                "esri/dijit/AttributeInspector",

                "esri/renderers/SimpleRenderer",
                "esri/symbols/SimpleFillSymbol",
                "esri/symbols/SimpleLineSymbol",
                "esri/Color",
       
                "dojo/ready", 
                "dojo/parser",
                "dojo/require",
                "dojo/sniff",
                "dojo/dom",
                "dojo/on",
                "dojo/_base/array",
                "dojo/_base/lang",
                "dojo/dom-construct",
                "dojo/dom-style",
                "dijit/form/Button",
                "dojo/domReady!"],
            function($, $ui, slick,
                    Map, Graphic, Geomtery, Edit, Draw, Extent, Point, esriBasemaps,
                    request, scaleUtils, webMercatorUtils, geodesicUtils, config, Query, QueryTask,
                    Geoprocessor, FeatureLayer, Basemap, BasemapGallery, GeometryService, Units,
                    Legend, TemplatePicker, AttributeInspector,
                    SimpleRenderer, SimpleFillSymbol, SimpleLineSymbol, Color,
                    ready, parser, require, sniff, dom, on, array, lang, domConstruct, domStyle, dojoButton) {

                ready(function(){
                    dojo.require("bootstrap");
                    var updateClass;
                    var org;
                    var editToolbar;
                    var refLayers;
                    var templateFields;
                    var serviceURL;

                    parser.parse();
                    config.defaults.io.proxyUrl = "http://localhost/proxy/proxy.ashx";
                    var geomServ = new GeometryService("https://maps.dot.state.tx.us/arcgis/rest/services/Utilities/Geometry/GeometryServer");//swamp thang
                    // var geomServ = new GeometryService("http://tasks.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer");

                    esriBasemaps.SPM = {
                        baseMapLayers: [
                          { url: "http://tiles.arcgis.com/tiles/KTcxiTD9dsQw4r7Z/arcgis/rest/services/Statewide_Planning_Map/MapServer" }
                        ],
                        title : "TxDOT",
                        thumbnailUrl : "http://maps.dot.state.tx.us/AGO_Template/TxDOT_Viewer/images/Basemaps/SPM.png"
                    };


                    var map = new Map("divMap", {
                      center: [-100, 32],
                      zoom: 7,
                      basemap: "SPM",
                      logo: false
                    });

                    var basemapGallery = new BasemapGallery({
                        map: map
                    });
                    var SPM = new Basemap({
                        id: "SPM",
                        title: "TxDOT Planning Map",
                        thumbnailUrl: "./statewideplanningmap.png",
                        layers:[
                          { url: "http://tiles.arcgis.com/tiles/KTcxiTD9dsQw4r7Z/arcgis/rest/services/Statewide_Planning_Map/MapServer" }
                        ]
                    });
                    basemapGallery.add(SPM);

                    on(basemapGallery, "load", function() {
                        $.each(basemapGallery.basemaps, function (bm, value) {
                            var image = value.thumbnailUrl;
                            var label = value.title;
                            var id = value.id;
                            $("#basemapItemList").append("<div class='basemapItem' id='" + id + "'><img class='basemapImg' id='" + id + "' src='" + image + "'><p id='" + id + "' style='color:white;'>" + label + "</p></div>");
                        });
                        $('.basemapItemList').slick({
                            infinite: true,
                            slidesToShow: 5,
                            slidesToScroll: 5,
                            responsive: [
                                {
                                  breakpoint: 1024,
                                  settings: {
                                    slidesToShow: 4,
                                    slidesToScroll: 4,
                                    infinite: true,
                                    dots: true
                                  }
                                },
                                {
                                  breakpoint: 600,
                                  settings: {
                                    slidesToShow: 3,
                                    slidesToScroll: 3,
                                    infinite: true,
                                    dots: true
                                  }
                                },
                                {
                                  breakpoint: 480,
                                  settings: {
                                    slidesToShow: 2,
                                    slidesToScroll: 2,
                                    infinite: true,
                                    dots: true
                                  }
                                }
                            ]
                        });
                        $(".basemapItem").click(function (event) {
                            var choice = event.target.id;
                            basemapGallery.select(choice);
                        });
                        $("#basemapPanel").slideToggle("fast");
                    });

                    ////CRI FEATURE LAYERS & EVENTS
                    var countiesURL = "https://maps.dot.state.tx.us/arcgis/rest/services/TPPuser/CountyRoads_Poly/MapServer/0";//swamp thang
                    var counties = new FeatureLayer(countiesURL,{
                        mode: FeatureLayer.MODE_ONDEMAND,
                        opacity: .5,
                        showLabels: false,
                        outFields: ["CNTY_NM", "CNTY_NBR"]
                    });

                    var updatesURL = "https://maps.dot.state.tx.us/arcgis/rest/services/TPPuser/CountyRoads_Updates/FeatureServer/0";//swamp thang
                    var updatesLyr = new FeatureLayer(updatesURL,{
                        mode: FeatureLayer.MODE_ONDEMAND,
                        showLabels: true,
                        outFields: ['*']
                    });

                    // var crURL = "http://services.arcgis.com/KTcxiTD9dsQw4r7Z/arcgis/rest/services/CountyRoads/FeatureServer/0";//swamp thang
                    var crURL = "https://maps.dot.state.tx.us/arcgis/rest/services/TPPuser/CountyRoads/MapServer/0";
                    var countyroads = new FeatureLayer(crURL,{
                        id: "CR",
                        mode: FeatureLayer.MODE_ONDEMAND,
                        showLabels: true,
                        outFields: ["*"]
                    });

                    ////LS FEATURE LAYERS & EVENTS
                    var ls_maintenanceURL = "https://maps.dot.state.tx.us/arcgis/rest/services/TPPuser/LocalStreets_Poly/MapServer/0";//swamp thang
                    var ls_maintenance = new FeatureLayer(ls_maintenanceURL,{
                        mode: FeatureLayer.MODE_ONDEMAND,
                        opacity: .5,
                        showLabels: false,
                        outFields: ["*"]
                    });

                    var ls_updatesURL = "https://maps.dot.state.tx.us/arcgis/rest/services/TPPuser/LocalStreets_Updates/FeatureServer/0";//swamp thang
                    var ls_updatesLyr = new FeatureLayer(ls_updatesURL,{
                        mode: FeatureLayer.MODE_ONDEMAND,
                        showLabels: true,
                        outFields: ['*']
                    });

                    var lsURL = "https://maps.dot.state.tx.us/arcgis/rest/services/TPPuser/LocalStreets/MapServer/0";//swamp thang
                    var localstreets = new FeatureLayer(lsURL,{
                        id: "LS",
                        mode: FeatureLayer.MODE_ONDEMAND,
                        showLabels: true,
                        outFields: ["*"]
                    });

                    ////MAP EVENTS & FUNCTIONS
                    map.on("load", function() {
                            map.on("mouse-move", showCoordinates);
                            map.on("mouse-drag", showCoordinates);
                            map.disableDoubleClickZoom();
                        });
                    map.on("zoom-end", function() {
                        var current = $("#info").html();
                        var coords = ", " + current.split(",")[1] + ", " + current.split(",")[2];
                        $("#info").html("Level: " + map.getZoom() + coords);
                    });
                    

                    function showCoordinates(evt) {
                        var mp = webMercatorUtils.webMercatorToGeographic(evt.mapPoint);
                        document.getElementById("info").innerHTML = "Level: " + map.getZoom() + ", " + mp.x.toFixed(6) + ", " + mp.y.toFixed(6);
                    }

                    function presentData() {
                        $("#menuPanel").slideToggle();
                        var legendInfos;
                        var templateLayers;
                        var editorInfos;
                        var expression;
                        var query = new Query();

                        function findExtent(results){
                            var orgBoundary = array.map(results.features, function(result){
                                    return result;
                            });
                            var ext = orgBoundary[0].geometry.getExtent().expand(1.15);
                            map.setExtent(ext);

                        }

                        if (updateClass == "CR") {
                            expression = "CNTY_NBR = " + org;

                            updatesLyr.setDefinitionExpression("COUNTY = " + org);
                            counties.setDefinitionExpression(expression);
                            countyroads.setDefinitionExpression("COUNTY = " + org);

                            map.addLayers([counties, countyroads, updatesLyr]);

                            $("#resources").append("Resources:<br><a>&bull; </a><a href='./ApplicationInstructions.pdf' target='Instructions' title='How to use this Webmap'>Instructions</a><br><a>&bull; </a><a href='./COUNTY_ROAD_CRITERIA.pdf' target='CRI Criteria' title='TxDOT Definition of a County Road'>Criteria</a><br><a>&bull; </a><a href='ftp://ftp.dot.state.tx.us/pub/txdot-info/tpp/countyfiles/2015/' id='FTPlink' target='Download' title='Download CRI Zipfile Packet for Selected County'>Download Packet</a>");
                        
                            var queryTask = new QueryTask(countiesURL);
                            query.where = expression;
                            query.returnGeometry = true;
                            queryTask.execute(query, findExtent);

                            legendInfos = [{
                                    layer: countyroads,
                                    defaultSymbol: false,
                                    title: "Surface Type"
                                },{
                                    layer: counties,
                                    defaultSymbol: false,
                                    title: "Active County"
                                }];

                            templateLayers = [updatesLyr];
                            refLayers = [updatesLyr, countyroads];
                            templateFields = ['LENGTH', 'SURFACE', 'NUM_LANES', 'HWY_DESIGN', 'FULL_NAME', 'CHANGE', 'COMMENT', 'COUNTY', 'CONTROLSEC'];
                            serviceURL = updatesURL;

                            editorInfos = [{
                                    'featureLayer':updatesLyr,
                                    'showAttachments': false,
                                    'isEditable': true,
                                    'fieldInfos': [{
                                        'fieldName': "CHANGE",
                                        'label': "Update Type",
                                        'isEditable': true
                                    },{
                                        'fieldName': "COUNTY",
                                        'label': "County Number",
                                        'isEditable': false
                                    },{
                                        'fieldName': "LENGTH",
                                        'label': "Length (Miles)",
                                        'isEditable': false
                                    },{
                                        'fieldName': "SURFACE",
                                        'label': "Surface Type",
                                        // 'tooltip': "Acceptable Values:<br>10 - Dirt/Natural<br>32 - Gravel<br>51 - Paved<br>61 - Concrete"
                                    },{
                                        'fieldName': "NUM_LANES",
                                        'label': "Number of Lanes"
                                    },{
                                        'fieldName': "HWY_DESIGN",
                                        'label': "Highway Design",
                                        // 'tooltip': "Acceptable Values:<br>1 - One Way<br>2 - Two Way<br>3 - Boulevard"
                                    },{
                                        'fieldName': "FULL_NAME",
                                        'label': "Full Street Name"
                                    },{
                                        'fieldName': "COMMENT",
                                        'label': "Comment"
                                    }]
                                }, {
                                    'featureLayer':countyroads,
                                    'showAttachments': false,
                                    'isEditable': false,
                                    'fieldInfos': [{
                                        'fieldName': "COUNTY",
                                        'label': "County Number"
                                    },{
                                        'fieldName': "LEN_OF_SECTION",
                                        'label': "Length (Miles)"
                                    },{
                                        'fieldName': "SURFACE_TYPE",
                                        'label': "Surface Type"
                                    },{
                                        'fieldName': "NUMBER_OF_LANES",
                                        'label': "Number of Lanes"
                                    },{
                                        'fieldName': "HIGHWAY_DESIGN",
                                        'label': "Highway Design"
                                    },{
                                        'fieldName': "FULL_NAME",
                                        'label': "Full Street Name"
                                    }]
                                }];
                            
                        }

                        else if (updateClass == "LS") {
                            expression = "ACRNM = '" + org + "'";

                            ls_updatesLyr.setDefinitionExpression("SOURCE = '" + org + "'");
                            ls_maintenance.setDefinitionExpression(expression);
                            if (org !== "CSEC") {
                                localstreets.setDefinitionExpression("ACRNM1 = '" + org + "' OR ACRNM2 = '" + org + "'");
                            }

                            map.addLayers([ls_maintenance, localstreets, ls_updatesLyr]);

                            $("#resources").append("Resources:<br><a>&bull; </a><a href='./ApplicationInstructions.pdf' target='Instructions' title='How to use this Webmap'>Instructions</a><br><a>&bull; </a><a href='./COUNTY_ROAD_CRITERIA.pdf' target='CRI Criteria' title='TxDOT Definition of a County Road'>Criteria</a><br><a>&bull; </a><a href='ftp://ftp.dot.state.tx.us/pub/txdot-info/tpp/countyfiles/2015/' id='FTPlink' target='Download' title='Download CRI Zipfile Packet for Selected County'>Download Packet</a>");
                        
                            var queryTask = new QueryTask(ls_maintenanceURL);
                            query.where = expression;
                            query.returnGeometry = true;
                            queryTask.execute(query, findExtent);

                            legendInfos = [{
                                    layer: localstreets,
                                    defaultSymbol: false,
                                    title: "Local Streets"
                                },{
                                    layer: ls_maintenance,
                                    defaultSymbol: false,
                                    title: "Data Maintenance Area"
                                }];

                            templateLayers = [ls_updatesLyr];
                            refLayers = [ls_updatesLyr, localstreets];
                            templateFields = ['SOURCE', 'DateUpdate', 'RoadUnqID', 'SN_PreMod', 'SN_PreDir', 'SN_PreType', 'StreetName', 'SN_PstType', 'SN_PstDir', 'SN_PstMod', 'FS_PreDir', 'FS_PstType', 'FS_PstDir', 'SpeedLimit', 'RoadClass', 'CHANGE','LENGTH','FULL_NAME', 'HWY_DESIGN', 'COMMENT'];
                            serviceURL = ls_updatesURL;

                            editorInfos = [{
                                    'featureLayer':ls_updatesLyr,
                                    'showAttachments': false,
                                    'isEditable': true,
                                    'fieldInfos': [{
                                        'fieldName': "CHANGE",
                                        'label': "Update Type",
                                        'isEditable': true
                                    },{
                                        'fieldName': "SOURCE",
                                        'label': "Source",
                                        'isEditable': false
                                    },{
                                        'fieldName': "LENGTH",
                                        'label': "Length (Miles)",
                                        'isEditable': false
                                    },{
                                        'fieldName': "SN_PreMod",
                                        'label': "Street Name Pre-Modifier",
                                    },{
                                        'fieldName': "SN_PreDir",
                                        'label': "Street Name Pre-Directional",
                                    },{
                                        'fieldName': "SN_PreType",
                                        'label': "Street Name Pre-Type"
                                    },{
                                        'fieldName': "StreetName",
                                        'label': "Street Name",
                                    },{
                                        'fieldName': "SN_PstType",
                                        'label': "Street Name Post-Type"
                                    },{
                                        'fieldName': "SN_PstDir",
                                        'label': "Street Name Post-Directional"
                                    },{
                                        'fieldName': "SN_PstMod",
                                        'label': "Street Name Post-Modifier",
                                    },{
                                        'fieldName': "RoadClass",
                                        'label': "Road Class",
                                    },{
                                        'fieldName': "SpeedLimit",
                                        'label': "Speed Limit"
                                    },{
                                        'fieldName': "HWY_DESIGN",
                                        'label': "Design"
                                    },{
                                        'fieldName': "COMMENT",
                                        'label': "Comment"
                                    }]
                                }, {
                                    'featureLayer':localstreets,
                                    'showAttachments': false,
                                    'isEditable': false,
                                    'fieldInfos': [{
                                        'fieldName': "RTE_RB_NM",
                                        'label': "Street Name"
                                    },{
                                        'fieldName': "RTE_LEN",
                                        'label': "Length (Miles)"
                                    },{
                                        'fieldName': "RTE_NBR",
                                        'label': "Route Number"
                                    },{
                                        'fieldName': "NAME1",
                                        'label': "Primary Admin"
                                    },{
                                        'fieldName': "ACRNM1",
                                        'label': "Admin Abbrev."
                                    },{
                                        'fieldName': "SOURCE1",
                                        'label': "Admin Type"
                                    },{
                                        'fieldName': "NAME2",
                                        'label': "TxDOT District"
                                    }]
                                }];
                            
                        }

                        initLegend(legendInfos);
                        initTemplates(templateLayers);
                        initAttributes(editorInfos);
                        setupSelection();
                            
                    }
                    
                    function setupSelection() {
                        $.each(refLayers, function(index, lyr){
                            var selectionSymbol = new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, new Color([0,255,255]), 2);
                            lyr.setSelectionSymbol(selectionSymbol);

                            lyr.on("mouse-over", function(){
                                map.setMapCursor("pointer");
                            });
                            lyr.on("mouse-out", function(){
                                map.setMapCursor("default");
                            });

                        });
                    }

                    function initLegend (Infos) {
                        var legend = new Legend({
                            map: map,
                            layerInfos: Infos,
                            respectCurrentMapScale: true
                        }, "legend");
                        legend.startup();
                    }

                    function initTemplates(templateLayers) {
                        
                        var tpCustom = new TemplatePicker({
                            featureLayers: templateLayers,
                            grouping: false,
                            columns: 1,
                            emptyMessage: "Nothing to edit"
                        }, "editTemplate");
                        tpCustom.startup();

                        document.getElementById("dojox_grid__View_2").style.width = "100%";

                        var drawToolbar = new Draw(map);
                        var selectedTemplate;
                        tpCustom.on("selection-change", function(){
                            if(tpCustom.getSelected()){
                                selectedTemplate = tpCustom.getSelected();
                                drawToolbar.activate(Draw.POLYLINE);
                            }
                        });

                        drawToolbar.on("draw-end", function(evt) {
                            drawToolbar.deactivate();
                            var numb;
                            var autoAttributes;
                            
                            var fixed = webMercatorUtils.webMercatorToGeographic(evt.geometry);
                            var lengther = geodesicUtils.geodesicLengths([fixed], Units.MILES);
                            var rounder = parseFloat(lengther).toFixed(3);
                            
                            var blankAttributes = lang.mixin({}, selectedTemplate.template.prototype.attributes);
                            if (updateClass == "CR"){
                                numb = parseInt(org);
                                autoAttributes = lang.mixin(blankAttributes, {"COUNTY":numb, "LENGTH": rounder});
                            }
                            else if (updateClass == "LS"){
                                numb = org;
                                var d = new Date();
                                var m = d.getMonth() + 1;
                                var day = d.getDate();
                                var yr = d.getFullYear();
                                var t = m.toString() + "/" + day.toString() + "/" + yr.toString();
                                autoAttributes = lang.mixin(blankAttributes, {"SOURCE":numb, "LENGTH": rounder, "DateUpdate": t});
                            }
                            
                            var newGraphic = new Graphic(evt.geometry, null, autoAttributes);
                            selectedTemplate.featureLayer.applyEdits([newGraphic], null, null);
                            
                            tpCustom.clearSelection();
                        });
                        
                        $("#menuPanel").slideToggle();
                        buildEditToolbar();

                    }
                    
                    function selectFeature(evt){

                        refLayers[0].clearSelection();
                        refLayers[1].clearSelection();

                        var centerPoint = new Point(evt.mapPoint.x,evt.mapPoint.y,evt.mapPoint.spatialReference);
                        var mapWidth = map.extent.getWidth();
                        var pixelWidth = mapWidth/map.width;
                        var tolerance = 5 * pixelWidth;
                        var queryExtent = new Extent(1,1,tolerance,tolerance,evt.mapPoint.spatialReference);
                        
                        var selectQuery = new Query();
                        selectQuery.geometry = queryExtent.centerAt(centerPoint);
                        
                        refLayers[0].selectFeatures(selectQuery, FeatureLayer.SELECTION_NEW, function(features) {
                            if (features.length > 0) {
                                // map.infoWindow.setTitle(features[0].getLayer().name);
                                map.infoWindow.setTitle("Inventory Changes");
                                map.infoWindow.show(evt.screenPoint, map.getInfoWindowAnchor(evt.screenPoint));
                                document.getElementById("dijit_form_Button_5").parentElement.style.display = "block";
                                
                            }
                            else {
                                refLayers[1].selectFeatures(selectQuery, FeatureLayer.SELECTION_NEW, function(features) {
                                    if (features.length > 0) {
                                        // map.infoWindow.setTitle(features[0].getLayer().name);
                                        map.infoWindow.setTitle("Current Inventory");
                                        map.infoWindow.show(evt.screenPoint, map.getInfoWindowAnchor(evt.screenPoint));
                                        document.getElementById("dijit_form_Button_5").parentElement.style.display = "none";
                                    }
                                    else {
                                        map.infoWindow.hide();
                                    }
                                });
                            }
                        });
                        
                    }
                    
                    function initAttributes(editorInfos) { 
                        
                        refLayers[0].on("click", selectFeature);
                        refLayers[1].on("click", selectFeature);
                     

                        var aiCustom = new AttributeInspector({
                            layerInfos: editorInfos
                        }, domConstruct.create("div"));

                        var geomButton = new dojoButton({label: "Edit Geometry"},domConstruct.create("div"));
                        domConstruct.place(geomButton.domNode, aiCustom.deleteBtn.domNode, "after");


                        geomButton.on("click", function() {
                            var features = refLayers[0].getSelectedFeatures();
                            var feature = features[0];
                            map.infoWindow.hide();
                            activateToolbar(feature);
                        });

                        aiCustom.on("attribute-change", function(evt){
                            evt.feature.attributes[evt.fieldName] = evt.fieldValue;
                            refLayers[0].applyEdits(null, [evt.feature], null);
                        });

                        aiCustom.on("delete", function(evt) {
                            refLayers[0].applyEdits(null, null, [evt.feature]);
                            map.infoWindow.hide();
                            editToolbar.deactivate();
                        });

                        map.infoWindow.setContent(aiCustom.domNode);
                        map.infoWindow.resize(350, 240);

                    }
                        

                    function buildEditToolbar() {
                        editToolbar = new Edit(map);
                        editToolbar.on("deactivate", function(evt) {
                            var numb;
                            var fixed = webMercatorUtils.webMercatorToGeographic(evt.graphic.geometry);
                            var lengther = geodesicUtils.geodesicLengths([fixed], Units.MILES);
                            var rounder = parseFloat(lengther).toFixed(3);
                            
                            if (updateClass == "CR") {
                                numb = parseInt(org);
                                evt.graphic.attributes.COUNTY = numb;
                                evt.graphic.attributes.LENGTH = rounder;
                            }
                            else if (updateClass == "LS") {
                                numb = org;
                                evt.graphic.attributes.SOURCE = numb;
                                evt.graphic.attributes.LENGTH = rounder;

                                var d = new Date();
                                var m = d.getMonth() + 1;
                                var day = d.getDate();
                                var yr = d.getFullYear();
                                var t = m.toString() + "/" + day.toString() + "/" + yr.toString();
                                evt.graphic.attributes.DateUpdate = t;
                            }
                            
                            refLayers[0].applyEdits(null, [evt.graphic], null);
                        });
                        map.on("click", function(evt){
                            editToolbar.deactivate();
                            if (!('graphic' in evt)){
                                map.infoWindow.hide();
                                refLayers[0].clearSelection();
                                refLayers[1].clearSelection();
                            }

                        });
                    }

                    function activateToolbar(graphic) {
                        var ghostLine = new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, new Color([201,201,201]), 2);   
                        var options = {
                            allowAddVertices: true,
                            allowDeleteVertices: true,
                            ghostLineSymbol: ghostLine
                        };
                        editToolbar.activate(Edit.EDIT_VERTICES, graphic, options);
                    }
                


                    ////DOWNLOAD FUNCTIONS
                    on(dom.byId("download"), "click", function () {
                        var gp = new Geoprocessor("https://maps.dot.state.tx.us/arcgis/rest/services/TPPuser/downloadUpdates/GPServer/Updates");//swamp thang
                        var params = {
                            "UpdateClass": updateClass,
                            "Organization": org,
                            "DownloadFormat": $("#downloadFormat").val(),
                            "ChooseData": $("#chooseData").val()
                          };
                          console.log(params);
                        dom.byId('downloadMarquee').innerHTML = "Started...";
                        gp.submitJob(params, completeCallback , statusCallback, function(error){
                            console.log(error);
                            dom.byId('downloadMarquee').innerHTML = "<p style='color:red'>There was an error.</p>";
                        });
                        function completeCallback(jobInfo){
                          if ( jobInfo.jobStatus !== "esriJobFailed" ) {
                            gp.getResultData(jobInfo.jobId, "OUTPUT", downloadFile);
                          }
                        }
                        function statusCallback(jobInfo) {
                          var status = jobInfo.jobStatus;
                          //dom.byId('downloadMarquee').innerHTML = status;
                          dom.byId('downloadMarquee').innerHTML = "<p style='color:black'>Preparing your download...<br> This may take several minutes for large datasets.</p>"
                          if ( status === "esriJobFailed" ) {
                            dom.byId('downloadMarquee').innerHTML = "<p style='color:red'>Uh-oh... Something went wrong.</p>";
                            console.log(jobInfo);
                          }
                          else if (status === "esriJobSucceeded"){
                            dom.byId('downloadMarquee').innerHTML = "<p style='color:green'>Success!</p>";
                          }
                        }
                        function downloadFile(outputFile){
                          map.graphics.clear();
                          var theurl = outputFile.value.url;  
                          window.location = theurl;
                        }
                    });


                    ////UPLOAD FUNCTIONS
                    on(dom.byId("uploadForm"), "change", function (event) {
                        dom.byId('uploadMarquee').innerHTML = "";
                        var fileName = event.target.value.toLowerCase();

                        if (sniff("ie")) { //filename is full path in IE so extract the file name
                          var arr = fileName.split("\\");
                          fileName = arr[arr.length - 1];
                        }
                        if (fileName.indexOf(".zip") !== -1) {//is file a zip - if not notify user
                          generateFeatureCollection(fileName);
                        }
                        else {
                          dom.byId('upload-status').innerHTML = '<p style="color:red">Add shapefile as .zip file</p>';
                        }
                    });

                    function generateFeatureCollection (fileName) {
                        var name = fileName.split(".");
                        name = name[0].replace("c:\\fakepath\\", "");

                        dom.byId('upload-status').innerHTML = '<b>Loading </b>' + name;

                        var params = {
                          'name': name,
                          'targetSR': map.spatialReference,
                          'maxRecordCount': 1000,
                          'enforceInputFileSizeLimit': true,
                          'enforceOutputJsonSizeLimit': true
                        };

                        //generalize features for display Here we generalize at 1:40,000 which is approx 10 meters
                        //This should work well when using web mercator.
                        var extent = scaleUtils.getExtentForScale(map, 40000);
                        var resolution = extent.getWidth() / map.width;
                        params.generalize = true;
                        params.maxAllowableOffset = resolution;
                        params.reducePrecision = true;
                        params.numberOfDigitsAfterDecimal = 0;

                        var myContent = {
                          'filetype': 'shapefile',
                          'publishParameters': JSON.stringify(params),
                          'f': 'json',
                          'callback.html': 'textarea'
                        };
                        //use the rest generate operation to generate a feature collection from the zipped shapefile
                        var portalUrl = "http://www.arcgis.com";//swamp thang
                        request({
                          url: portalUrl + '/sharing/rest/content/features/generate',
                          content: myContent,
                          form: dom.byId('uploadForm'),
                          handleAs: 'json',
                          load: lang.hitch(this, function (response) {
                            if (response.error) {
                              errorHandler(response.error);
                              return;
                            }
                            var layerName = response.featureCollection.layers[0].layerDefinition.name;
                            dom.byId('upload-status').innerHTML = '<b>Loaded: </b>' + layerName;
                            verifySchema(response.featureCollection);
                          }),
                          error: lang.hitch(this, errorHandler)
                        });
                    }

                    function errorHandler (error) {
                        dom.byId('uploadMarquee').innerHTML = '<p style="color:red">' + error.message + '</p>';
                    }

                    function verifySchema (featureCollection) {

                        var fieldFlag = false;
                        var attFlag = false;
                        var badField;

                        array.forEach(featureCollection.layers, function (layer) {

                            array.forEach(layer.featureSet.features, function (feature) {
                                array.forEach(templateFields, function (field) {
                                    if (field in feature.attributes) {
                                        var att = feature.attributes[field];
                                        if (att == undefined || att == null || att == " " || att == "") {
                                           // attFlag = true;
                                           // badField = field;
                                        }
                                    }
                                    else {
                                        fieldFlag = true;
                                    }
                                });
                            });

                        });

                        if(fieldFlag) {
                            alert("Shapefile does not contain all required fields.");
                            dom.byId('uploadMarquee').innerHTML = '<p style="color:red">Shapefile does not contain all required fields.<br><p style="font-size: xx-small;">Updates can only be uploaded via the schema template shapefile acquired from the Download section of this menu.</p></p>';
                        }
                        else {
                            if (attFlag) {
                                alert(badField + " has a NULL or blank value which must be populated.");
                                dom.byId('uploadMarquee').innerHTML = '<p style="color:red">' + badField + " has a NULL or blank value which must be populated." + '</p>';
                            }
                            else {
                                addShapefileToMap(featureCollection);
                                dom.byId('uploadMarquee').innerHTML = '<p style="color:green">Submited shapefile has passed all validation checks.</p>';
                                serviceLoad(featureCollection);
                            }
                        }
                    }

                    function addShapefileToMap (featureCollection) {
                        //add the shapefile to the map and zoom to the feature collection extent
                        //If you want to persist the feature collection when you reload browser you could store the collection in
                        //local storage by serializing the layer using featureLayer.toJson()  see the 'Feature Collection in Local Storage' sample
                        //for an example of how to work with local storage.
                        var fullExtent;
                        var layers = [];

                        array.forEach(featureCollection.layers, function (layer) {
                          var featureLayer = new FeatureLayer(layer);
                          fullExtent = fullExtent ?
                            fullExtent.union(featureLayer.fullExtent) : featureLayer.fullExtent;
                          layers.push(featureLayer);
                        });
                        map.addLayers(layers);
                        map.setExtent(fullExtent.expand(1.25), true);
                        
                    }

                    function serviceLoad (featureCollection) {
                        var uploadURL = serviceURL + "/addFeatures?f=json&features=";
                        // var uploadURL = serviceURL + "/applyEdits?f=json&adds=";

                             var xmlhttp;
                            if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
                                xmlhttp=new XMLHttpRequest();
                            }
                            else {// code for IE6, IE5
                                xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
                            }
                            xmlhttp.onreadystatechange = function() {
                                if (xmlhttp.readyState === 4 && xmlhttp.status === 200) {
                                   //document.getElementById("uploadStatus").innerHTML = xmlhttp.responseText;
                                   console.log(xmlhttp.responseText);
                                }
                            };

                        array.forEach(featureCollection.layers, function (layer) {
                            var total = layer.featureSet.features;
                            var counter = 0;
                            // console.log(total);
                            // updatesLyr.applyEdits(total, null, null);
                            // console.log(layer);
                                    // updatesLyr.applyEdits([newGraphic], null, null);
                            array.forEach(layer.featureSet.features, function (feature) {
                                console.log(feature);
                                var geom = feature.geometry;
                                var paths = JSON.stringify(geom.paths);
                                var theText;
                                if (updateClass == "CR") {
                                   theText = "{'geometry':{'paths':" + paths + "},'attributes':{'COUNTY':" + org + ", 'FULL_NAME':" + feature.attributes.FULL_NAME + "}}";
                                }
                                else if (updateClass == "LS") {
                                    theText = "{'geometry':{'paths':" + paths + "},'attributes':{'SOURCE':" + org + ", 'StreetName':" + feature.attributes.StreetName + "}}";
                                }
                                theText = uploadURL + "[" + theText + "]";
                                // var layersRequest = request({
                                //     url: theText
                                //     },{
                                //     usePost: true
                                // });
                            //     layersRequest.then(
                            //         function(response) {
                            //             var res = response.addResults[0]["success"];
                            //             if (res) {
                            //                 counter += 1;
                            //                 if (counter === total){
                            //                     dom.byId('uploadMarquee').innerHTML = '<p style="color:green">Records uploaded to service.</p>';
                            //                 }
                            //                 console.log("Success: ", response.layers);
                            //             } else {
                            //                 dom.byId('uploadMarquee').innerHTML = "Upload Failed. Try again with an internet connection.";
                            //                 alert("Upload Failed. Try again with an internet connection. (1)");
                            //             }
                            //         }, function(error) {
                            //             console.log("Ugh Error: ", error);
                            //     });
                            
                            console.log(theText);
                            xmlhttp.open("POST",theText,false);
                            try {
                                xmlhttp.send();
                                if (xmlhttp.status >= 200 && xmlhttp.status < 304) {
                                    if (xmlhttp.responseText.slice(-7) === "true}]}"){
                                        //counter += 1;
                                        console.log("got a good one");
                                    }
                                } else {
                                    // document.getElementById('overlay').style.display='none';
                                    // document.getElementById('wait').style.display='none';
                                    // x.innerHTML = 'Upload Failed. Try again with an internet connection.';
                                    // for (var i = 0; i < Buttons.length; i++) {
                                    //     Buttons[i].disabled = false;
                                    // }
                                    // alert("Upload Failed. Try again with an internet connection.");
                                    console.log("shit");
                                }
                            } catch (e) {
                                // document.getElementById('overlay').style.display='none';
                                // document.getElementById('wait').style.display='none';
                                // x.innerHTML = 'Upload Failed. Try again with an internet connection.';
                                // for (var i = 0; i < Buttons.length; i++) {
                                //     Buttons[i].disabled = false;
                                // }
                                // alert("Upload Failed. Try again with an internet connection.");
                                console.log(e);
                            }
                            });

                        });
                    }



                    ////JQUERY EVENTS
                    $("#needHelp").click(function(){$("#popHelp").toggle("fast");});
                    $("#menuBtn").click(function(){
                        $("#menuPanel").slideToggle("fast");
                        $("#menuArrow").toggleClass('glyphicon-chevron-up glyphicon-chevron-down');
                    });
                    $("#basemapTrigger").mouseover(function(){
                        $("#basemapPanel").slideToggle("fast");
                    });

                    ////inital sign in page
                    $('#signIn').submit(function(event){
                        event.preventDefault();
                        var routeClass = $("#inventoryClass").val();
                        var organization = $("#selectOrg").val();
                        var accessCode = $("#accessCode").val();

                        if(routeClass != null){
                            if(organization != null){
                                if(routeClass == "CR"){
                                    if(accessCode == "porksoda"){
                                        $('#loginModal').modal("hide");
                                        updateClass = routeClass;
                                        org = organization;
                                        presentData();
                                    }
                                    else{
                                        alert("Invalid access code.");
                                        $("#accessCode").val("");
                                    }
                                }
                                else if(routeClass == "LS"){
                                    if(accessCode == "raindogs"){
                                        $('#loginModal').modal("hide");
                                        updateClass = routeClass;
                                        org = organization;
                                        presentData();
                                    }
                                    else{
                                        alert("Invalid access code.");
                                        $("#accessCode").val("");
                                    }
                                }
                            }
                            else{
                                alert("You must choose 'Your Organization' to continue.");
                            }
                        }
                        else{
                            alert("You must choose an 'Inventory to Update' to continue.");
                        }
                    });

                    $("#inventoryClass").change(function(){
                        $("#selectOrg").prop("disabled", false);
                        $("#selectOrg").val("#");
                        var routeClass = $("#inventoryClass").val();
                        if (routeClass == "CR") {
                            $(".crOption").attr("style", "display:block;");
                            $(".lsOption").attr("style", "display:none;");
                        }
                        else if (routeClass == "LS") {
                            $(".crOption").attr("style", "display:none;");
                            $(".lsOption").attr("style", "display:block;");
                        }
                    });

                    $("#chooseData").change(function(){
                        var value = $("#chooseData").val();
                        if (value == "DATA") {
                            $("#downloadFormat").prop("disabled", false);
                        }
                        else if (value == "SCHEMA") {
                            $("#downloadFormat").prop("disabled", true);
                            $("#downloadFormat").val("SHP").change();

                        }
                    });
                    
                    ////On load
                    map.on("load", function(){$('#loginModal').modal({show: true, keyboard: false, backdrop: 'static'});});
                });
            });
        </script>
    </head>
    <body class="tundra">
        <div id="loginModal" class="modal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="text-center">Sign-In</h1>
                    </div>
                    <div class="modal-body">
                        <form id="signIn" class="form col-md-12 center-block">
                            <div class="form-group">
                                <select class="form-control input-lg" id="inventoryClass">
                                    <option value="#" disabled selected>Choose an Inventory to Update</option>
                                    <option value="CR">County Roads</option>
                                    <option value="LS">Local Streets</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <select class="form-control input-lg" id="selectOrg" disabled="disabled">
                                    <option value="#" disabled selected>Choose Your Organization</option>
                                    <option class='crOption' value='1' style='display:none;'>Anderson - 1</option> <option class='crOption' value='2' style='display:none;'>Andrews - 2</option> <option class='crOption' value='3' style='display:none;'>Angelina - 3</option> <option class='crOption' value='4' style='display:none;'>Aransas - 4</option> <option class='crOption' value='5' style='display:none;'>Archer - 5</option>    <option class='crOption' value='6' style='display:none;'>Armstrong - 6</option> <option class='crOption' value='7' style='display:none;'>Atascosa - 7</option>  <option class='crOption' value='8' style='display:none;'>Austin - 8</option>    <option class='crOption' value='9' style='display:none;'>Bailey - 9</option>    <option class='crOption' value='10' style='display:none;'>Bandera - 10</option> <option class='crOption' value='11' style='display:none;'>Bastrop - 11</option> <option class='crOption' value='12' style='display:none;'>Baylor - 12</option>  <option class='crOption' value='13' style='display:none;'>Bee - 13</option> <option class='crOption' value='14' style='display:none;'>Bell - 14</option>    <option class='crOption' value='15' style='display:none;'>Bexar - 15</option>   <option class='crOption' value='16' style='display:none;'>Blanco - 16</option>  <option class='crOption' value='17' style='display:none;'>Borden - 17</option>  <option class='crOption' value='18' style='display:none;'>Bosque - 18</option>  <option class='crOption' value='19' style='display:none;'>Bowie - 19</option>   <option class='crOption' value='20' style='display:none;'>Brazoria - 20</option>    <option class='crOption' value='21' style='display:none;'>Brazos - 21</option>  <option class='crOption' value='22' style='display:none;'>Brewster - 22</option>    <option class='crOption' value='23' style='display:none;'>Briscoe - 23</option> <option class='crOption' value='24' style='display:none;'>Brooks - 24</option>  <option class='crOption' value='25' style='display:none;'>Brown - 25</option>   <option class='crOption' value='26' style='display:none;'>Burleson - 26</option>    <option class='crOption' value='27' style='display:none;'>Burnet - 27</option>  <option class='crOption' value='28' style='display:none;'>Caldwell - 28</option>    <option class='crOption' value='29' style='display:none;'>Calhoun - 29</option> <option class='crOption' value='30' style='display:none;'>Callahan - 30</option>    <option class='crOption' value='31' style='display:none;'>Cameron - 31</option> <option class='crOption' value='32' style='display:none;'>Camp - 32</option>    <option class='crOption' value='33' style='display:none;'>Carson - 33</option>  <option class='crOption' value='34' style='display:none;'>Cass - 34</option>    <option class='crOption' value='35' style='display:none;'>Castro - 35</option>  <option class='crOption' value='36' style='display:none;'>Chambers - 36</option>    <option class='crOption' value='37' style='display:none;'>Cherokee - 37</option>    <option class='crOption' value='38' style='display:none;'>Childress - 38</option>   <option class='crOption' value='39' style='display:none;'>Clay - 39</option>    <option class='crOption' value='40' style='display:none;'>Cochran - 40</option> <option class='crOption' value='41' style='display:none;'>Coke - 41</option>    <option class='crOption' value='42' style='display:none;'>Coleman - 42</option> <option class='crOption' value='43' style='display:none;'>Collin - 43</option>  <option class='crOption' value='44' style='display:none;'>Collingsworth - 44</option>   <option class='crOption' value='45' style='display:none;'>Colorado - 45</option>    <option class='crOption' value='46' style='display:none;'>Comal - 46</option>   <option class='crOption' value='47' style='display:none;'>Comanche - 47</option>    <option class='crOption' value='48' style='display:none;'>Concho - 48</option>  <option class='crOption' value='49' style='display:none;'>Cooke - 49</option>   <option class='crOption' value='50' style='display:none;'>Coryell - 50</option> <option class='crOption' value='51' style='display:none;'>Cottle - 51</option>  <option class='crOption' value='52' style='display:none;'>Crane - 52</option>   <option class='crOption' value='53' style='display:none;'>Crockett - 53</option>    <option class='crOption' value='54' style='display:none;'>Crosby - 54</option>  <option class='crOption' value='55' style='display:none;'>Culberson - 55</option>   <option class='crOption' value='56' style='display:none;'>Dallam - 56</option>  <option class='crOption' value='57' style='display:none;'>Dallas - 57</option>  <option class='crOption' value='58' style='display:none;'>Dawson - 58</option>  <option class='crOption' value='59' style='display:none;'>Deaf Smith - 59</option>  <option class='crOption' value='60' style='display:none;'>Delta - 60</option>   <option class='crOption' value='61' style='display:none;'>Denton - 61</option>  <option class='crOption' value='62' style='display:none;'>De Witt - 62</option> <option class='crOption' value='63' style='display:none;'>Dickens - 63</option> <option class='crOption' value='64' style='display:none;'>Dimmit - 64</option>  <option class='crOption' value='65' style='display:none;'>Donley - 65</option>  <option class='crOption' value='66' style='display:none;'>Kenedy - 66</option>  <option class='crOption' value='67' style='display:none;'>Duval - 67</option>   <option class='crOption' value='68' style='display:none;'>Eastland - 68</option>    <option class='crOption' value='69' style='display:none;'>Ector - 69</option>   <option class='crOption' value='70' style='display:none;'>Edwards - 70</option> <option class='crOption' value='71' style='display:none;'>Ellis - 71</option>   <option class='crOption' value='72' style='display:none;'>El Paso - 72</option> <option class='crOption' value='73' style='display:none;'>Erath - 73</option>   <option class='crOption' value='74' style='display:none;'>Falls - 74</option>   <option class='crOption' value='75' style='display:none;'>Fannin - 75</option>  <option class='crOption' value='76' style='display:none;'>Fayette - 76</option> <option class='crOption' value='77' style='display:none;'>Fisher - 77</option>  <option class='crOption' value='78' style='display:none;'>Floyd - 78</option>   <option class='crOption' value='79' style='display:none;'>Foard - 79</option>   <option class='crOption' value='80' style='display:none;'>Fort Bend - 80</option>   <option class='crOption' value='81' style='display:none;'>Franklin - 81</option>    <option class='crOption' value='82' style='display:none;'>Freestone - 82</option>   <option class='crOption' value='83' style='display:none;'>Frio - 83</option>    <option class='crOption' value='84' style='display:none;'>Gaines - 84</option>  <option class='crOption' value='85' style='display:none;'>Galveston - 85</option>   <option class='crOption' value='86' style='display:none;'>Garza - 86</option>   <option class='crOption' value='87' style='display:none;'>Gillespie - 87</option>   <option class='crOption' value='88' style='display:none;'>Glasscock - 88</option>   <option class='crOption' value='89' style='display:none;'>Goliad - 89</option>  <option class='crOption' value='90' style='display:none;'>Gonzales - 90</option>    <option class='crOption' value='91' style='display:none;'>Gray - 91</option>    <option class='crOption' value='92' style='display:none;'>Grayson - 92</option> <option class='crOption' value='93' style='display:none;'>Gregg - 93</option>   <option class='crOption' value='94' style='display:none;'>Grimes - 94</option>  <option class='crOption' value='95' style='display:none;'>Guadalupe - 95</option>   <option class='crOption' value='96' style='display:none;'>Hale - 96</option>    <option class='crOption' value='97' style='display:none;'>Hall - 97</option>    <option class='crOption' value='98' style='display:none;'>Hamilton - 98</option>    <option class='crOption' value='99' style='display:none;'>Hansford - 99</option>    <option class='crOption' value='100' style='display:none;'>Hardeman - 100</option>  <option class='crOption' value='101' style='display:none;'>Hardin - 101</option>    <option class='crOption' value='102' style='display:none;'>Harris - 102</option>    <option class='crOption' value='103' style='display:none;'>Harrison - 103</option>  <option class='crOption' value='104' style='display:none;'>Hartley - 104</option>   <option class='crOption' value='105' style='display:none;'>Haskell - 105</option>   <option class='crOption' value='106' style='display:none;'>Hays - 106</option>  <option class='crOption' value='107' style='display:none;'>Hemphill - 107</option>  <option class='crOption' value='108' style='display:none;'>Henderson - 108</option> <option class='crOption' value='109' style='display:none;'>Hidalgo - 109</option>   <option class='crOption' value='110' style='display:none;'>Hill - 110</option>  <option class='crOption' value='111' style='display:none;'>Hockley - 111</option>   <option class='crOption' value='112' style='display:none;'>Hood - 112</option>  <option class='crOption' value='113' style='display:none;'>Hopkins - 113</option>   <option class='crOption' value='114' style='display:none;'>Houston - 114</option>   <option class='crOption' value='115' style='display:none;'>Howard - 115</option>    <option class='crOption' value='116' style='display:none;'>Hudspeth - 116</option>  <option class='crOption' value='117' style='display:none;'>Hunt - 117</option>  <option class='crOption' value='118' style='display:none;'>Hutchinson - 118</option>    <option class='crOption' value='119' style='display:none;'>Irion - 119</option> <option class='crOption' value='120' style='display:none;'>Jack - 120</option>  <option class='crOption' value='121' style='display:none;'>Jackson - 121</option>   <option class='crOption' value='122' style='display:none;'>Jasper - 122</option>    <option class='crOption' value='123' style='display:none;'>Jeff Davis - 123</option>    <option class='crOption' value='124' style='display:none;'>Jefferson - 124</option> <option class='crOption' value='125' style='display:none;'>Jim Hogg - 125</option>  <option class='crOption' value='126' style='display:none;'>Jim Wells - 126</option> <option class='crOption' value='127' style='display:none;'>Johnson - 127</option>   <option class='crOption' value='128' style='display:none;'>Jones - 128</option> <option class='crOption' value='129' style='display:none;'>Karnes - 129</option>    <option class='crOption' value='130' style='display:none;'>Kaufman - 130</option>   <option class='crOption' value='131' style='display:none;'>Kendall - 131</option>   <option class='crOption' value='132' style='display:none;'>Kent - 132</option>  <option class='crOption' value='133' style='display:none;'>Kerr - 133</option>  <option class='crOption' value='134' style='display:none;'>Kimble - 134</option>    <option class='crOption' value='135' style='display:none;'>King - 135</option>  <option class='crOption' value='136' style='display:none;'>Kinney - 136</option>    <option class='crOption' value='137' style='display:none;'>Kleberg - 137</option>   <option class='crOption' value='138' style='display:none;'>Knox - 138</option>  <option class='crOption' value='139' style='display:none;'>Lamar - 139</option> <option class='crOption' value='140' style='display:none;'>Lamb - 140</option>  <option class='crOption' value='141' style='display:none;'>Lampasas - 141</option>  <option class='crOption' value='142' style='display:none;'>La Salle - 142</option>  <option class='crOption' value='143' style='display:none;'>Lavaca - 143</option>    <option class='crOption' value='144' style='display:none;'>Lee - 144</option>   <option class='crOption' value='145' style='display:none;'>Leon - 145</option>  <option class='crOption' value='146' style='display:none;'>Liberty - 146</option>   <option class='crOption' value='147' style='display:none;'>Limestone - 147</option> <option class='crOption' value='148' style='display:none;'>Lipscomb - 148</option>  <option class='crOption' value='149' style='display:none;'>Live Oak - 149</option>  <option class='crOption' value='150' style='display:none;'>Llano - 150</option> <option class='crOption' value='151' style='display:none;'>Loving - 151</option>    <option class='crOption' value='152' style='display:none;'>Lubbock - 152</option>   <option class='crOption' value='153' style='display:none;'>Lynn - 153</option>  <option class='crOption' value='154' style='display:none;'>Madison - 154</option>   <option class='crOption' value='155' style='display:none;'>Marion - 155</option>    <option class='crOption' value='156' style='display:none;'>Martin - 156</option>    <option class='crOption' value='157' style='display:none;'>Mason - 157</option> <option class='crOption' value='158' style='display:none;'>Matagorda - 158</option> <option class='crOption' value='159' style='display:none;'>Maverick - 159</option>  <option class='crOption' value='160' style='display:none;'>McCulloch - 160</option> <option class='crOption' value='161' style='display:none;'>McLennan - 161</option>  <option class='crOption' value='162' style='display:none;'>McMullen - 162</option>  <option class='crOption' value='163' style='display:none;'>Medina - 163</option>    <option class='crOption' value='164' style='display:none;'>Menard - 164</option>    <option class='crOption' value='165' style='display:none;'>Midland - 165</option>   <option class='crOption' value='166' style='display:none;'>Milam - 166</option> <option class='crOption' value='167' style='display:none;'>Mills - 167</option> <option class='crOption' value='168' style='display:none;'>Mitchell - 168</option>  <option class='crOption' value='169' style='display:none;'>Montague - 169</option>  <option class='crOption' value='170' style='display:none;'>Montgomery - 170</option>    <option class='crOption' value='171' style='display:none;'>Moore - 171</option> <option class='crOption' value='172' style='display:none;'>Morris - 172</option>    <option class='crOption' value='173' style='display:none;'>Motley - 173</option>    <option class='crOption' value='174' style='display:none;'>Nacogdoches - 174</option>   <option class='crOption' value='175' style='display:none;'>Navarro - 175</option>   <option class='crOption' value='176' style='display:none;'>Newton - 176</option>    <option class='crOption' value='177' style='display:none;'>Nolan - 177</option> <option class='crOption' value='178' style='display:none;'>Nueces - 178</option>    <option class='crOption' value='179' style='display:none;'>Ochiltree - 179</option> <option class='crOption' value='180' style='display:none;'>Oldham - 180</option>    <option class='crOption' value='181' style='display:none;'>Orange - 181</option>    <option class='crOption' value='182' style='display:none;'>Palo Pinto - 182</option>    <option class='crOption' value='183' style='display:none;'>Panola - 183</option>    <option class='crOption' value='184' style='display:none;'>Parker - 184</option>    <option class='crOption' value='185' style='display:none;'>Parmer - 185</option>    <option class='crOption' value='186' style='display:none;'>Pecos - 186</option> <option class='crOption' value='187' style='display:none;'>Polk - 187</option>  <option class='crOption' value='188' style='display:none;'>Potter - 188</option>    <option class='crOption' value='189' style='display:none;'>Presidio - 189</option>  <option class='crOption' value='190' style='display:none;'>Rains - 190</option> <option class='crOption' value='191' style='display:none;'>Randall - 191</option>   <option class='crOption' value='192' style='display:none;'>Reagan - 192</option>    <option class='crOption' value='193' style='display:none;'>Real - 193</option>  <option class='crOption' value='194' style='display:none;'>Red River - 194</option> <option class='crOption' value='195' style='display:none;'>Reeves - 195</option>    <option class='crOption' value='196' style='display:none;'>Refugio - 196</option>   <option class='crOption' value='197' style='display:none;'>Roberts - 197</option>   <option class='crOption' value='198' style='display:none;'>Robertson - 198</option> <option class='crOption' value='199' style='display:none;'>Rockwall - 199</option>  <option class='crOption' value='200' style='display:none;'>Runnels - 200</option>   <option class='crOption' value='201' style='display:none;'>Rusk - 201</option>  <option class='crOption' value='202' style='display:none;'>Sabine - 202</option>    <option class='crOption' value='203' style='display:none;'>San Augustine - 203</option> <option class='crOption' value='204' style='display:none;'>San Jacinto - 204</option>   <option class='crOption' value='205' style='display:none;'>San Patricio - 205</option>  <option class='crOption' value='206' style='display:none;'>San Saba - 206</option>  <option class='crOption' value='207' style='display:none;'>Schleicher - 207</option>    <option class='crOption' value='208' style='display:none;'>Scurry - 208</option>    <option class='crOption' value='209' style='display:none;'>Shackelford - 209</option>   <option class='crOption' value='210' style='display:none;'>Shelby - 210</option>    <option class='crOption' value='211' style='display:none;'>Sherman - 211</option>   <option class='crOption' value='212' style='display:none;'>Smith - 212</option> <option class='crOption' value='213' style='display:none;'>Somervell - 213</option> <option class='crOption' value='214' style='display:none;'>Starr - 214</option> <option class='crOption' value='215' style='display:none;'>Stephens - 215</option>  <option class='crOption' value='216' style='display:none;'>Sterling - 216</option>  <option class='crOption' value='217' style='display:none;'>Stonewall - 217</option> <option class='crOption' value='218' style='display:none;'>Sutton - 218</option>    <option class='crOption' value='219' style='display:none;'>Swisher - 219</option>   <option class='crOption' value='220' style='display:none;'>Tarrant - 220</option>   <option class='crOption' value='221' style='display:none;'>Taylor - 221</option>    <option class='crOption' value='222' style='display:none;'>Terrell - 222</option>   <option class='crOption' value='223' style='display:none;'>Terry - 223</option> <option class='crOption' value='224' style='display:none;'>Throckmorton - 224</option>  <option class='crOption' value='225' style='display:none;'>Titus - 225</option> <option class='crOption' value='226' style='display:none;'>Tom Green - 226</option> <option class='crOption' value='227' style='display:none;'>Travis - 227</option>    <option class='crOption' value='228' style='display:none;'>Trinity - 228</option>   <option class='crOption' value='229' style='display:none;'>Tyler - 229</option> <option class='crOption' value='230' style='display:none;'>Upshur - 230</option>    <option class='crOption' value='231' style='display:none;'>Upton - 231</option> <option class='crOption' value='232' style='display:none;'>Uvalde - 232</option>    <option class='crOption' value='233' style='display:none;'>Val Verde - 233</option> <option class='crOption' value='234' style='display:none;'>Van Zandt - 234</option> <option class='crOption' value='235' style='display:none;'>Victoria - 235</option>  <option class='crOption' value='236' style='display:none;'>Walker - 236</option>    <option class='crOption' value='237' style='display:none;'>Waller - 237</option>    <option class='crOption' value='238' style='display:none;'>Ward - 238</option>  <option class='crOption' value='239' style='display:none;'>Washington - 239</option>    <option class='crOption' value='240' style='display:none;'>Webb - 240</option>  <option class='crOption' value='241' style='display:none;'>Wharton - 241</option>   <option class='crOption' value='242' style='display:none;'>Wheeler - 242</option>   <option class='crOption' value='243' style='display:none;'>Wichita - 243</option>   <option class='crOption' value='244' style='display:none;'>Wilbarger - 244</option> <option class='crOption' value='245' style='display:none;'>Willacy - 245</option>   <option class='crOption' value='246' style='display:none;'>Williamson - 246</option>    <option class='crOption' value='247' style='display:none;'>Wilson - 247</option>    <option class='crOption' value='248' style='display:none;'>Winkler - 248</option>   <option class='crOption' value='249' style='display:none;'>Wise - 249</option>  <option class='crOption' value='250' style='display:none;'>Wood - 250</option>  <option class='crOption' value='251' style='display:none;'>Yoakum - 251</option>    <option class='crOption' value='252' style='display:none;'>Young - 252</option> <option class='crOption' value='253' style='display:none;'>Zapata - 253</option>    <option class='crOption' value='254' style='display:none;'>Zavala - 254</option>
                                    <option class='lsOption' value='ABLCTY' style='display:none;'>Abilene (CITY)</option>   <option class='lsOption' value='ABL' style='display:none;'>Abilene (DISTRICT)</option>  <option class='lsOption' value='AACOG' style='display:none;'>Alamo Area Council of Governments (COG)</option>   <option class='lsOption' value='AMA' style='display:none;'>Amarillo (DISTRICT)</option> <option class='lsOption' value='ARK-TEX' style='display:none;'>Ark-Tex Council of Governments (COG)</option>    <option class='lsOption' value='ATL' style='display:none;'>Atlanta (DISTRICT)</option>  <option class='lsOption' value='AUS' style='display:none;'>Austin (DISTRICT)</option>   <option class='lsOption' value='BMT' style='display:none;'>Beaumont (DISTRICT)</option> <option class='lsOption' value='BXR911' style='display:none;'>Bexar 911 (E911_COUNTY)</option>  <option class='lsOption' value='BVCOG' style='display:none;'>Brazos Valley Council of Governments (COG)</option>    <option class='lsOption' value='BWD' style='display:none;'>Brownwood (DISTRICT)</option>    <option class='lsOption' value='BRY' style='display:none;'>Bryan (DISTRICT)</option>    <option class='lsOption' value='CLHCO' style='display:none;'>Calhoun (COUNTY)</option>  <option class='lsOption' value='CAPCOG' style='display:none;'>Capital Area Council of Governments (COG)</option> <option class='lsOption' value='CTCOG' style='display:none;'>Central Texas Council of Governments (COG)</option>    <option class='lsOption' value='CHS' style='display:none;'>Childress (DISTRICT)</option>    <option class='lsOption' value='CBCOG' style='display:none;'>Coastal Bend Council of Governments (COG)</option> <option class='lsOption' value="CSEC" style='display:none;'>Comission on State Emergency Communications (STATE)</option> <option class='lsOption' value='CVCOG' style='display:none;'>Concho Valley Council of Governments (COG)</option>    <option class='lsOption' value='CRP' style='display:none;'>Corpus Christi (DISTRICT)</option>   <option class='lsOption' value='DAL' style='display:none;'>Dallas (DISTRICT)</option>   <option class='lsOption' value='DETCOG' style='display:none;'>Deep East Texas Council of Governments (COG)</option> <option class='lsOption' value='ETCOG' style='display:none;'>East Texas Council of Governments (COG)</option>   <option class='lsOption' value='ELP' style='display:none;'>El Paso (DISTRICT)</option>  <option class='lsOption' value='ELPMPO' style='display:none;'>El Paso MPO (MPO)</option>   <option class='lsOption' value='FTW' style='display:none;'>Fort Worth (DISTRICT)</option>   <option class='lsOption' value='GCRPC' style='display:none;'>Golden Crescent Regional Planning Commission (COG)</option>    <option class='lsOption' value='HOTCOG' style='display:none;'>Heart of Texas Council of Governments (COG)</option>  <option class='lsOption' value='HOU' style='display:none;'>Houston (DISTRICT)</option>  <option class='lsOption' value='H-GAC' style='display:none;'>Houston-Galveston Area Council (COG)</option>  <option class='lsOption' value='KRR911' style='display:none;'>Kerr 911 (E911_COUNTY)</option>   <option class='lsOption' value='LRD' style='display:none;'>Laredo (DISTRICT)</option>   <option class='lsOption' value='LRGVDC' style='display:none;'>Lower Rio Grande Valley Development Council (COG)</option>    <option class='lsOption' value='LBBCO' style='display:none;'>Lubbock (COUNTY)</option>  <option class='lsOption' value='LBB' style='display:none;'>Lubbock (DISTRICT)</option>  <option class='lsOption' value='LFK' style='display:none;'>Lufkin (DISTRICT)</option>   <option class='lsOption' value='MLNCO' style='display:none;'>McLennan (COUNTY)</option> <option class='lsOption' value='MDACO' style='display:none;'>Medina (COUNTY)</option>   <option class='lsOption' value='MDA911' style='display:none;'>Medina 911 (E911_COUNTY)</option> <option class='lsOption' value='MRGDC' style='display:none;'>Middle Rio Grande Development Council (COG)</option>   <option class='lsOption' value='MLDCTY' style='display:none;'>Midland (CITY)</option>   <option class='lsOption' value='NORTEX' style='display:none;'>Nortex Regional Planning Commission (COG)</option>    <option class='lsOption' value='NCTCOG' style='display:none;'>North Central Texas Council of Governments (COG)</option> <option class='lsOption' value='ODACTY' style='display:none;'>Odessa (CITY)</option>    <option class='lsOption' value='ODA' style='display:none;'>Odessa (DISTRICT)</option>   <option class='lsOption' value='PRPC' style='display:none;'>Panhandle Regional Planning Commission (COG)</option>   <option class='lsOption' value='PAR' style='display:none;'>Paris (DISTRICT)</option>    <option class='lsOption' value='PBRPC' style='display:none;'>Permian Basin Regional Planning Commission (COG)</option>  <option class='lsOption' value='PHR' style='display:none;'>Pharr (DISTRICT)</option>    <option class='lsOption' value='RGCOG' style='display:none;'>Rio Grande Council of Governments (COG)</option>   <option class='lsOption' value='SJT' style='display:none;'>San Angelo (DISTRICT)</option>   <option class='lsOption' value='SAT' style='display:none;'>San Antonio (DISTRICT)</option>  <option class='lsOption' value='SETRPC' style='display:none;'>South East Texas Regional Planning Commission (COG)</option>  <option class='lsOption' value='SPAG' style='display:none;'>South Plains Association of Governments (COG)</option>  <option class='lsOption' value='STDC' style='display:none;'>South Texas Development Council (COG)</option>  <option class='lsOption' value='TEXOMA' style='display:none;'>Texoma Council of Governments (COG)</option>  <option class='lsOption' value='TYL' style='display:none;'>Tyler (DISTRICT)</option>    <option class='lsOption' value='VTACTY' style='display:none;'>Victoria (CITY)</option>  <option class='lsOption' value='WAC' style='display:none;'>Waco (DISTRICT)</option> <option class='lsOption' value='WCTCOG' style='display:none;'>West Central Texas Council of Governments (COG)</option>  <option class='lsOption' value='WTACO' style='display:none;'>Wichita (COUNTY)</option>  <option class='lsOption' value='WFS' style='display:none;'>Wichita Falls (DISTRICT)</option>    <option class='lsOption' value='WBGCO' style='display:none;'>Wilbarger (COUNTY)</option>    <option class='lsOption' value='YKM' style='display:none;'>Yoakum (DISTRICT)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <input type="password" class="form-control input-lg" placeholder="Access Code" id="accessCode">
                            </div>
                            <div class="form-group">
                                <button class="btn btn-primary btn-lg btn-block">Sign In</button>
                                    <a id="needHelp" href="#">Need Help?</a>
                                    <div id="popHelp" style="display:none">
                                            <p><br>Welcome to the Road Inventory Update Application!<br><br>If you do not have an access code, please contact TxDOT TPP's Data Management Section to acquire one.</p>
                                    </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer" style="border:none;">
                        <div class="col-md-12"></div>    
                    </div>
                </div>
            </div>
        </div>

        
        <div id="divMap">
            <div id="menuContainer">
                <div id="menuPanel">
                    <div class="panel-group" id="accordion">
                        <div class="panel panel-default">
                            <div class="panel-heading btn-default" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" style="cursor: pointer;">
                                <h4 class="panel-title">Edit</h4>
                            </div>
                            <div id="collapseOne" class="panel-collapse collapse in">
                                <div class="panel-body">
                                    <!--<p>Edit the data stuff here. Template, edit tools, etc. Submits edit button which sends email?</p>-->
                                    <div id="editTemplate"></div>
                                    <br>
                                    <div id="legend"></div>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-default">
                            <div class="panel-heading btn-default collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" style="cursor: pointer;">
                                <h4 class="panel-title">Download</h4>
                            </div>
                            <div id="collapseTwo" class="panel-collapse collapse">
                                <div class="panel-body">
                                    <p>Download a copy of your data inventory or a schema template for editing and uploading changes.<br><p style="font-size: xx-small;">Note: Downloading your data inventory in the Shapefile format may truncate field names.</p></p>
                                    <select class="form-control" id="chooseData">
                                        <option value="SCHEMA" selected>Schema Only</option> <option value="DATA">Data & Schema</option>  
                                    </select>
                                    <select class="form-control" id="downloadFormat"  disabled="disabled">
                                        <option value="SHP" selected>Shapefile</option>  <option value="FGDB">File Geodatabase</option> 
                                    </select>
                                    
                                    <button type="button" class="btn btn-default" id="download"><span class="glyphicon glyphicon-download-alt"></span> Download!</button>
                                    <div id="downloadMarquee"></div>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-default">
                            <div class="panel-heading btn-default collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" style="cursor: pointer;">
                                <h4 class="panel-title">Upload</h4>
                            </div>
                            <div id="collapseThree" class="panel-collapse collapse">
                                <div class="panel-body">
                                    <p>Upload data here. Will go through geoprocessing verification first.</p>

                                    <div style='padding-left:4px;'>
                                        <p>Add a zipped shapefile to the map.</p><!-- swamp thang -->
                                        <p>Visit the<a target='_blank' href="http://doc.arcgis.com/en/arcgis-online/reference/shapefiles.htm"> Shapefiles </a>help topic for information and limitations.</p>
                                        <form class="form-group" enctype="multipart/form-data" method="post" id="uploadForm">
                                            <div class="form-group">
                                                <span class="btn btn-default btn-file"><span class="glyphicon glyphicon-search"></span> Choose a File
                                                    <input type="file" name="file"/>
                                                </span>
                                            </div>
                                        </form>
                                        <span class="file-upload-status" style="opacity:1;" id="upload-status"></span>
                                        <div id="fileInfo"></div>
                                        <div id="uploadMarquee"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-default">
                            <div class="panel-heading btn-default collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseFour" style="cursor: pointer;">
                                <h4 class="panel-title">Resources</h4>
                            </div>
                            <div id="collapseFour" class="panel-collapse collapse">
                                <div class="panel-body">
                                    <div id="resources"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <button id="menuBtn" type="button" class="btn btn-default"><span id="menuArrow" class="glyphicon glyphicon-chevron-down"></span></button>
            <span id="info"></span>
            <div id="basemapTrigger"></div>
                    <div id="basemapPanel">
                        <div id="basemapItemList" class="basemapItemList"></div>
                    </div>            
        </div>

    </body>
</html>
